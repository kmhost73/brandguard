<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BrandGuard AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#0D47A1',
              secondary: '#1565C0',
              accent: '#2196F3',
              success: '#4CAF50',
              warning: '#FFC107',
              danger: '#F44336',
              light: '#F5F5F5',
              dark: '#212121',
            }
          }
        }
      }
    </script>
    <style>
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .animate-fade-in {
        animation: fadeIn 0.5s ease-out forwards;
      }
    </style>
    <!-- React & Babel for in-browser JSX transpilation -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Google GenAI SDK -->
    <script type="module">
      import { GoogleGenAI, Type } from "https://esm.sh/@google/genai";
      window.GoogleGenAI = GoogleGenAI;
      window.GenaiType = Type;
    </script>
  </head>
  <body class="bg-light text-dark font-sans">
    <div id="root"></div>

    <script type="text/babel" data-presets="react">
      const { useState, useCallback, useEffect, useMemo } = React;
      
      // --- Icon Components ---
      const CheckIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-6 h-6"><path strokeLinecap="round" strokeLinejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg>);
      const WarningIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6"><path strokeLinecap="round" strokeLinejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.007H12v-.007Z" /></svg>);
      const XIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-6 h-6"><path strokeLinecap="round" strokeLinejoin="round" d="m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg>);
      const HistoryIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6"><path strokeLinecap="round" strokeLinejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg>);
      const TrashIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5"><path strokeLinecap="round" strokeLinejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.134-2.09-2.134H8.09a2.09 2.09 0 0 0-2.09 2.134v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" /></svg>);
      const PlusIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5"><path strokeLinecap="round" strokeLinejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>);
      const ChevronDownIcon = ({ className }) => (<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={`w-6 h-6 ${className}`}><path strokeLinecap="round" strokeLinejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" /></svg>);
      const CogIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6"><path strokeLinecap="round" strokeLinejoin="round" d="M4.5 12a7.5 7.5 0 0 0 15 0m-15 0a7.5 7.5 0 1 1 15 0m-15 0H3m18 0h-1.5m-15 0a7.5 7.5 0 1 1 15 0m-15 0H3m18 0h-1.5m-15 0a7.5 7.5 0 1 1 15 0m-15 0H3m18 0h-1.5" /></svg>);
      const SparklesIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5"><path strokeLinecap="round" strokeLinejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg>);
      const ShareIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5"><path strokeLinecap="round" strokeLinejoin="round" d="M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.186 2.25 2.25 0 0 0-3.933 2.186Z" /></svg>);
      
      // --- Gemini Service ---
      const createGeminiService = () => {
        // =================================================================================
        // === CRITICAL ACTION REQUIRED: Replace this placeholder with your API key. ===
        // =================================================================================
        const API_KEY = "YOUR_API_KEY_HERE";
        // =================================================================================

        const { GoogleGenAI, GenaiType: Type } = window;
        
        if (!GoogleGenAI || !API_KEY || API_KEY === "YOUR_API_KEY_HERE") {
            const missingKeyService = {
                analyzePostContent: async () => { throw new Error("API Key is not configured. Please replace 'YOUR_API_KEY_HERE' in the index.html file."); },
                analyzeVideoContent: async () => { throw new Error("API Key is not configured. Please replace 'YOUR_API_KEY_HERE' in the index.html file."); },
                generateCompliantRevision: async () => { throw new Error("API Key is not configured. Please replace 'YOUR_API_KEY_HERE' in the index.html file."); },
                isConfigured: () => false
            };
            return missingKeyService;
        }

        const ai = new GoogleGenAI({ apiKey: API_KEY });

        const complianceSchema = { type: Type.OBJECT, properties: { overallScore: { type: Type.INTEGER, description: "A compliance score from 0 to 100, where 100 is fully compliant." }, summary: { type: Type.STRING, description: "A brief, one-sentence summary of the compliance check results." }, checks: { type: Type.ARRAY, description: "An array of specific compliance checks that were performed.", items: { type: Type.OBJECT, properties: { name: { type: Type.STRING, description: "The name of the compliance check (e.g., 'FTC Disclosure', 'Brand Safety', 'Custom Rule: #BrandPartner'). Use the prefix 'Custom Rule:' for user-defined rules." }, status: { type: Type.STRING, description: "The result of the check. Must be one of: 'pass', 'fail', or 'warn'.", enum: ['pass', 'fail', 'warn'] }, details: { type: Type.STRING, description: "A detailed explanation of why the check passed, failed, or has a warning. Provide specifics." } }, required: ["name", "status", "details"] } } }, required: ["overallScore", "summary", "checks"] };
        const videoComplianceSchema = { type: Type.OBJECT, properties: { overallScore: { type: Type.INTEGER, description: "A compliance score from 0 to 100, where 100 is fully compliant, based on both visual and audio analysis." }, summary: { type: Type.STRING, description: "A brief, one-sentence summary of the compliance check results from both video and audio." }, checks: { type: Type.ARRAY, description: "An array of specific compliance checks that were performed on the video and its transcript.", items: { type: Type.OBJECT, properties: { name: { type: Type.STRING, description: "The name of the compliance check (e.g., 'Spoken Disclosure', 'Visual Brand Safety', 'Custom Rule: Mention 'Free Shipping''). Use the prefix 'Custom Rule:' for user-defined rules." }, status: { type: Type.STRING, description: "The result of the check. Must be one of: 'pass', 'fail', or 'warn'.", enum: ['pass', 'fail', 'warn'] }, details: { type: Type.STRING, description: "A detailed explanation of why the check passed, failed, or has a warning. Provide specifics." }, modality: { type: Type.STRING, description: "The modality of the check. Use 'audio' for checks on the transcript and 'visual' for checks on the video frames.", enum: ['audio', 'visual'] } }, required: ["name", "status", "details", "modality"] } } }, required: ["overallScore", "summary", "checks"] };
        const generateCustomRulesPrompt = (customRules) => { if (!customRules || customRules.length === 0) { return ""; } const rulesText = customRules.map((rule, index) => `${index + 1}. ${rule.text}`).join('\n'); return `\n**Additional Custom Campaign Rules:**\nYou MUST strictly enforce the following custom rules provided by the user. For each custom rule, create a separate check in the output JSON with the name prefixed by "Custom Rule:".\n${rulesText}\n`; };
        const fileToBase64 = (file) => new Promise((resolve, reject) => { const reader = new FileReader(); reader.readAsDataURL(file); reader.onload = () => resolve(reader.result.split(',')[1]); reader.onerror = (error) => reject(error); });

        const fullTextPrompt = (postContent, customRulesPrompt) => `Act as an expert social media compliance officer for a major brand. Your task is to analyze the following sponsored post caption for compliance with FTC guidelines, brand safety, and specific campaign requirements.\n\n**Post Caption to Analyze:**\n"${postContent}"\n\n**Standard Compliance Rules:**\n1.  **FTC Disclosure:** The post MUST contain a clear and conspicuous disclosure, such as #ad, #sponsored, or "Paid partnership". The disclosure should be easily visible, preferably at the beginning of the caption.\n2.  **Brand Safety:** The post must NOT contain any profanity, offensive language, controversial topics (politics, religion, etc.), or mention of competitor brands.\n3.  **Claim Accuracy:** The post must accurately represent the product. For this campaign, it must mention the phrase "made with 100% organic materials".\n${customRulesPrompt}\nPlease provide a strict analysis and return the results in the required JSON format.`;
        const fullVideoPrompt = (videoTranscript, customRulesPrompt) => `Act as an expert social media compliance officer. Analyze the provided video and its transcript for compliance with FTC guidelines, brand safety, and custom campaign requirements. You must perform checks on BOTH the visual content of the video and the audio content from the transcript.\n\n**Video Transcript for Audio Analysis:**\n"${videoTranscript}"\n\n**Standard Compliance Rules (Check both Audio & Visuals):**\n1.  **FTC Disclosure:**\n    - **Audio:** The transcript MUST contain a clear spoken disclosure (e.g., "this video is sponsored").\n    - **Visual:** The video should ideally have a visible text overlay with "#ad" or "#sponsored" for a significant duration.\n2.  **Brand Safety:**\n    - **Audio:** The spoken content must NOT contain profanity, offensive language, or controversial topics.\n    - **Visual:** The video must NOT contain inappropriate imagery, gestures, or competitor logos. The background should be clean and professional.\n3.  **Claim Accuracy & Brand Representation:**\n    - **Audio:** The speaker must mention "made with 100% organic materials".\n    - **Visual:** The product must be clearly visible and presented in a positive light. The brand's own logo should be visible if possible.\n${customRulesPrompt}\nProvide a strict analysis covering both modalities and return the results in the required JSON format. For each check, specify the modality as 'audio' or 'visual'.`;
        const fullRevisionPrompt = (originalContent, analysisType, issues) => `Act as an expert social media copywriter. Your task is to revise the following ${analysisType === 'text' ? 'Post Caption' : 'Video Script'} to make it fully compliant based on the issues identified.\n\n**Original ${analysisType === 'text' ? 'Post Caption' : 'Video Script'}:**\n"${originalContent}"\n\n**Identified Compliance Issues:**\n${issues}\n\n**Instructions:**\n1.  Rewrite the content to fix ALL the identified issues.\n2.  Maintain the original tone and voice as much as possible.\n3.  Do NOT add any commentary, explanations, or labels like "Revised Script:".\n4.  Output ONLY the revised text.`;

        return {
          isConfigured: () => true,
          analyzePostContent: async (postContent, customRules) => {
            const prompt = fullTextPrompt(postContent, generateCustomRulesPrompt(customRules));
            const response = await ai.models.generateContent({ model: "gemini-2.5-flash", contents: prompt, config: { responseMimeType: "application/json", responseSchema: complianceSchema }});
            const partialReport = JSON.parse(response.text);
            return { ...partialReport, id: crypto.randomUUID(), timestamp: new Date().toISOString(), sourceContent: postContent, analysisType: 'text', customRulesApplied: customRules };
          },
          analyzeVideoContent: async (videoTranscript, videoFile, customRules) => {
            const videoData64 = await fileToBase64(videoFile);
            const prompt = fullVideoPrompt(videoTranscript, generateCustomRulesPrompt(customRules));
            const response = await ai.models.generateContent({ model: "gemini-2.5-flash", contents: { parts: [{ text: prompt }, { inlineData: { mimeType: videoFile.type, data: videoData64 } }] }, config: { responseMimeType: "application/json", responseSchema: videoComplianceSchema }});
            const partialReport = JSON.parse(response.text);
            return { ...partialReport, id: crypto.randomUUID(), timestamp: new Date().toISOString(), sourceContent: videoTranscript, analysisType: 'video', customRulesApplied: customRules, };
          },
          generateCompliantRevision: async (originalContent, analysisType, failedChecks) => {
            const issues = failedChecks.map(check => `- ${check.name} (${check.modality || 'text'}): ${check.details}`).join('\n');
            const prompt = fullRevisionPrompt(originalContent, analysisType, issues);
            const response = await ai.models.generateContent({ model: "gemini-2.5-flash", contents: prompt });
            return response.text.trim();
          }
        };
      };

      // --- UI Components ---
      const Loader = () => ( <div className="flex flex-col items-center justify-center p-8"><div className="w-16 h-16 border-4 border-dashed rounded-full animate-spin border-primary"></div><p className="mt-4 text-gray-600">AI is analyzing the content...</p></div> );
      const Header = ({ navigateTo }) => ( <header className="bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-50"><div className="container mx-auto px-4 sm:px-6 lg:px-8"><div className="flex items-center justify-between h-16"><div className="flex-shrink-0 flex items-center gap-2 cursor-pointer" onClick={() => navigateTo('landing')}><svg className="h-8 w-8 text-primary" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M9 12.75 11.25 15 15 9.75m-3-7.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.749c0 5.592 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.286Zm0 13.036h.008v.008h-.008v-.008Z" /></svg><span className="text-2xl font-bold text-gray-800">BrandGuard AI</span></div><nav className="hidden md:flex md:space-x-8"><button onClick={() => navigateTo('landing')} className="font-medium text-gray-500 hover:text-primary transition-colors">Home</button><button onClick={() => navigateTo('dashboard')} className="font-medium text-gray-500 hover:text-primary transition-colors">Dashboard</button></nav></div></div></header> );
      const Hero = ({ navigateToDashboard }) => ( <div className="bg-white"><div className="container mx-auto px-4 sm:px-6 lg:px-8 py-20 text-center"><h1 className="text-4xl sm:text-5xl md:text-6xl font-extrabold text-gray-900 leading-tight"><span className="block">Automate Influencer Compliance.</span><span className="block text-primary">Protect Your Brand.</span></h1><p className="mt-6 max-w-2xl mx-auto text-lg sm:text-xl text-gray-500">BrandGuard AI uses advanced AI to continuously monitor sponsored content, ensuring FTC compliance and brand safety, so you can focus on growth.</p><div className="mt-8 flex justify-center"><button onClick={navigateToDashboard} className="inline-flex items-center justify-center px-8 py-4 border border-transparent text-base font-medium rounded-md text-white bg-primary hover:bg-secondary transition-transform transform hover:scale-105 shadow-lg">Try the Live Demo <svg className="ml-2 -mr-1 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fillRule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clipRule="evenodd" /></svg></button></div></div></div> );
      const Features = () => { const features = [ { icon: <CheckIcon/>, title: 'Automated Disclosure Checks', description: 'Our AI instantly verifies if influencer posts include required FTC disclosures like #ad or #sponsored, mitigating legal risks.' }, { icon: <WarningIcon/>, title: 'Brand Safety Monitoring', description: 'Scan content for profanity, sensitive topics, and competitor mentions to ensure all collaborations align with your brand values.' }, { icon: <SparklesIcon/>, title: 'AI-Powered Revisions', description: 'Instantly generate compliant revisions of problematic content with our "Magic Fix" feature, saving hours of back-and-forth.' } ]; return ( <div className="py-12 bg-gray-50"><div className="container mx-auto px-4 sm:px-6 lg:px-8"><div className="text-center"><h2 className="text-3xl font-extrabold text-gray-900">Why Choose BrandGuard AI?</h2><p className="mt-4 max-w-2xl mx-auto text-xl text-gray-500">We provide the tools you need to build trustworthy and effective influencer partnerships at scale.</p></div><div className="mt-10 grid gap-8 md:grid-cols-2 lg:grid-cols-3">{features.map((feature, index) => { const FeatureCard = ({ icon, title, description }) => (<div className="bg-white p-6 rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300"><div className="flex items-center justify-center h-12 w-12 rounded-md bg-primary text-white mb-4">{icon}</div><h3 className="text-lg font-semibold text-gray-900">{title}</h3><p className="mt-2 text-base text-gray-500">{description}</p></div>); return <FeatureCard key={index} {...feature} /> })}</div></div></div> ); };
      
      const ReportCard = ({ report, geminiService }) => {
        const statusConfig = { pass: { icon: <CheckIcon />, color: 'text-green-500', bgColor: 'bg-green-100', borderColor: 'border-green-300' }, warn: { icon: <WarningIcon />, color: 'text-yellow-500', bgColor: 'bg-yellow-100', borderColor: 'border-yellow-300' }, fail: { icon: <XIcon />, color: 'text-red-500', bgColor: 'bg-red-100', borderColor: 'border-red-300' }};
        const getScoreColor = (score) => { if (score >= 90) return 'text-success'; if (score >= 60) return 'text-warning'; return 'text-danger'; };
        const ModalityTag = ({ modality }) => { const config = { audio: { text: 'Audio', className: 'bg-blue-100 text-blue-800' }, visual: { text: 'Visual', className: 'bg-purple-100 text-purple-800' } }; const { text, className } = config[modality]; return (<span className={`ml-2 px-2 py-0.5 text-xs font-medium rounded-full ${className}`}>{text}</span>); };
        const CheckItemCard = ({ item }) => { const config = statusConfig[item.status]; return (<div className={`p-4 rounded-lg border ${config.bgColor} ${config.borderColor} flex items-start space-x-4`}><div className={`flex-shrink-0 w-6 h-6 ${config.color}`}>{config.icon}</div><div><h4 className="font-semibold text-gray-800 flex items-center">{item.name}{item.modality && <ModalityTag modality={item.modality} />}</h4><p className="text-gray-600">{item.details}</p></div></div>); };

        const hasCustomRules = report.customRulesApplied && report.customRulesApplied.length > 0;
        const failedChecks = report.checks.filter(c => c.status === 'fail');
        const [isRevising, setIsRevising] = useState(false);
        const [revisedContent, setRevisedContent] = useState(null);
        const [revisionError, setRevisionError] = useState(null);
        const [shareConfirmation, setShareConfirmation] = useState('');

        const handleGenerateRevision = async () => { if (failedChecks.length === 0) { setRevisionError("No failing checks to revise."); return; } setIsRevising(true); setRevisedContent(null); setRevisionError(null); try { const revision = await geminiService.generateCompliantRevision(report.sourceContent, report.analysisType, failedChecks); setRevisedContent(revision); } catch (err) { setRevisionError(err.message); } finally { setIsRevising(false); } };
        const handleShareReport = () => { try { const data = btoa(JSON.stringify(report)); const url = `${window.location.origin}${window.location.pathname}?report=${data}`; navigator.clipboard.writeText(url); setShareConfirmation('Link copied!'); setTimeout(() => setShareConfirmation(''), 3000); } catch (error) { setShareConfirmation('Could not create link.'); setTimeout(() => setShareConfirmation(''), 3000); }};

        return (
          <div className="bg-white shadow-lg rounded-lg overflow-hidden animate-fade-in">
            <div className="p-6">
              <h2 className="text-2xl font-bold text-gray-800 mb-4">Analysis Report</h2>
              <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6"><div className="bg-gray-50 p-4 rounded-lg text-center"><h3 className="text-sm font-medium text-gray-500 uppercase">Compliance Score</h3><p className={`text-5xl font-bold ${getScoreColor(report.overallScore)}`}>{report.overallScore}</p></div><div className="md:col-span-2 bg-gray-50 p-4 rounded-lg"><h3 className="text-sm font-medium text-gray-500 uppercase mb-2">AI Summary</h3><p className="text-gray-700">{report.summary}</p></div></div>
              {hasCustomRules && (<div className="mb-6"><h3 className="text-lg font-semibold text-gray-700 mb-3 flex items-center gap-2"><CogIcon/> Custom Rules Applied</h3><div className="bg-gray-50 p-4 rounded-lg border"><ul className="list-disc list-inside space-y-1 text-sm text-gray-600">{report.customRulesApplied?.map(rule => (<li key={rule.id}>{rule.text}</li>))}</ul></div></div>)}
              <h3 className="text-lg font-semibold text-gray-700 mb-4">Detailed Checks</h3>
              <div className="space-y-4">{report.checks.map((item, index) => (<CheckItemCard key={index} item={item} />))}</div>
            </div>
            <div className="p-6 border-t border-gray-200 bg-gray-50">
              <div className="flex justify-between items-center mb-4"><h3 className="text-lg font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary to-purple-600">Pro Features</h3><a href="#" className="text-xs font-semibold uppercase bg-yellow-200 text-yellow-800 px-2 py-1 rounded-full hover:bg-yellow-300" title="Upgrade to Pro to unlock these features">Upgrade</a></div>
              <div className="flex flex-col sm:flex-row gap-4">
                <button onClick={handleGenerateRevision} disabled={isRevising || failedChecks.length === 0} className="flex-1 inline-flex items-center justify-center gap-2 px-4 py-3 border border-transparent text-sm font-medium rounded-md text-white bg-secondary hover:bg-primary disabled:bg-gray-400 disabled:cursor-not-allowed transition-all shadow-sm" title={failedChecks.length === 0 ? "No failing checks to fix!" : "AI-powered content revision"}><SparklesIcon /> {isRevising ? 'Generating...' : 'Magic Fix'}</button>
                <button onClick={handleShareReport} className="flex-1 inline-flex items-center justify-center gap-2 px-4 py-3 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 transition-all shadow-sm"><ShareIcon /> {shareConfirmation ? shareConfirmation : 'Share Report'}</button>
              </div>
              {isRevising && <div className="mt-4"><Loader/></div>}
              {revisionError && <div className="mt-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg" role="alert">{revisionError}</div>}
              {revisedContent && (<div className="mt-6"><h4 className="font-semibold text-gray-800">AI-Generated Compliant Revision:</h4><div className="mt-2 p-4 bg-green-50 border-l-4 border-green-400 text-gray-800 rounded-r-lg"><p className="whitespace-pre-wrap font-mono text-sm">{revisedContent}</p></div></div>)}
            </div>
          </div>
        );
      };
      
      const PublicReportView = ({ report, geminiService }) => {
        return (
          <div className="min-h-screen bg-gray-50 flex flex-col">
            <header className="bg-white shadow-sm">
                 <div className="container mx-auto px-4 sm:px-6 lg:px-8">
                    <div className="flex items-center justify-between h-16">
                        <div className="flex-shrink-0 flex items-center gap-2">
                            <svg className="h-8 w-8 text-primary" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M9 12.75 11.25 15 15 9.75m-3-7.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.749c0 5.592 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.286Zm0 13.036h.008v.008h-.008v-.008Z" /></svg>
                            <span className="text-2xl font-bold text-gray-800">BrandGuard AI</span>
                        </div>
                    </div>
                </div>
            </header>
            <main className="flex-grow container mx-auto p-4 sm:p-6 lg:p-8">
                <div className="max-w-4xl mx-auto">
                    <div className="text-center mb-8">
                        <h1 className="text-3xl font-bold text-gray-800">Shared Compliance Report</h1>
                        <p className="text-gray-600 mt-2">This is a read-only view of a report generated by BrandGuard AI.</p>
                    </div>
                    <ReportCard report={report} geminiService={geminiService} />
                </div>
            </main>
            <footer className="w-full text-center p-6 bg-white border-t">
                <p className="text-gray-600">Want to run your own compliance checks and generate revisions?</p>
                <a href={window.location.origin} className="text-primary font-bold hover:underline text-lg">
                    Try BrandGuard AI for Free
                </a>
                <p className="text-xs text-gray-400 mt-4">&copy; 2024 BrandGuard AI. An AI-founded company.</p>
            </footer>
          </div>
        );
      };
      
      const Dashboard = ({ geminiService }) => {
        const [analysisType, setAnalysisType] = useState('text');
        const [postContent, setPostContent] = useState('');
        const [videoTranscript, setVideoTranscript] = useState('');
        const [selectedVideoFile, setSelectedVideoFile] = useState(null);
        const [isLoading, setIsLoading] = useState(false);
        const [report, setReport] = useState(null);
        const [error, setError] = useState(null);
        const [reportHistory, setReportHistory] = useState([]);
        const [customRules, setCustomRules] = useState([]);
        const [newRuleText, setNewRuleText] = useState('');
        const [showRules, setShowRules] = useState(false);
        
        const examplePost = `Loving my new eco-friendly sneakers! They are so comfy and stylish. Best part? They are made with 100% organic materials. You all have to check them out! #fashion #style`;
        const exampleVideoTranscript = `Hey everyone, welcome back to my channel! Today I wanted to show you these amazing new sneakers. They are just so comfortable. And what I love most is that they are made with 100% organic materials. I'm obsessed! Make sure you check them out, link is in the description!`;

        const getReportHistory = () => { try { const historyJson = localStorage.getItem('brandGuardReportHistory'); return historyJson ? JSON.parse(historyJson) : []; } catch (e) { return []; } };
        const getCustomRules = () => { try { const rulesJson = localStorage.getItem('brandGuardCustomRules'); return rulesJson ? JSON.parse(rulesJson) : []; } catch (e) { return []; } };
        const saveReportToHistory = (report) => { const history = getReportHistory(); const newHistory = [report, ...history].slice(0, 10); localStorage.setItem('brandGuardReportHistory', JSON.stringify(newHistory)); };
        const saveCustomRules = (rules) => { localStorage.setItem('brandGuardCustomRules', JSON.stringify(rules)); };
        
        useEffect(() => { setReportHistory(getReportHistory()); setCustomRules(getCustomRules()); }, []);

        const handleAnalysisCompletion = (newReport) => { setReport(newReport); saveReportToHistory(newReport); setReportHistory(getReportHistory()); };

        const handleScan = async () => {
          setIsLoading(true);
          setReport(null);
          setError(null);
          try {
            let result;
            if (analysisType === 'text') {
              if (!postContent.trim()) throw new Error("Please enter post content to analyze.");
              result = await geminiService.analyzePostContent(postContent, customRules);
            } else {
              if (!videoTranscript.trim() || !selectedVideoFile) throw new Error("Please provide a video file and its transcript.");
              result = await geminiService.analyzeVideoContent(videoTranscript, selectedVideoFile, customRules);
            }
            handleAnalysisCompletion(result);
          } catch (err) {
            setError(err.message);
          } finally {
            setIsLoading(false);
          }
        };

        const resetState = (clearInputs = true) => { setReport(null); setError(null); if(clearInputs){ setPostContent(''); setVideoTranscript(''); setSelectedVideoFile(null); } };
        const switchTab = (type) => { setAnalysisType(type); resetState(); };
        const viewHistoricReport = (historicReport) => { resetState(false); setReport(historicReport); window.scrollTo({ top: 0, behavior: 'smooth' }); };
        const deleteReport = (reportId) => { const newHistory = reportHistory.filter(r => r.id !== reportId); localStorage.setItem('brandGuardReportHistory', JSON.stringify(newHistory)); setReportHistory(newHistory); if (report?.id === reportId) { setReport(null); } };
        const addRule = () => { if(newRuleText.trim()) { const newRule = { id: crypto.randomUUID(), text: newRuleText.trim() }; const updatedRules = [...customRules, newRule]; setCustomRules(updatedRules); saveCustomRules(updatedRules); setNewRuleText(''); } };
        const deleteRule = (ruleId) => { const updatedRules = customRules.filter(r => r.id !== ruleId); setCustomRules(updatedRules); saveCustomRules(updatedRules); };

        return (
          <div className="container mx-auto p-4 sm:p-6 lg:p-8">
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
              <div className="lg:col-span-2">
                  <h1 className="text-3xl font-bold text-gray-800 mb-2">Compliance Dashboard</h1>
                  <p className="text-gray-600 mb-6">Analyze content against FTC guidelines, brand safety, and your own custom rules.</p>
                  <div className="mb-4 border-b border-gray-200"><nav className="-mb-px flex space-x-6"><button onClick={() => switchTab('text')} className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${analysisType === 'text' ? 'border-primary text-primary' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'}`}>Text Post</button><button onClick={() => switchTab('video')} className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${analysisType === 'video' ? 'border-primary text-primary' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'}`}>Video Post</button></nav></div>
                  
                  <div className="bg-gray-50 rounded-lg p-4 mb-6 border border-gray-200">
                    <button onClick={() => setShowRules(!showRules)} className="w-full flex justify-between items-center text-left text-lg font-semibold text-gray-700"><span className="flex items-center gap-2"><CogIcon/> Custom Rules Engine</span><ChevronDownIcon className={`transform transition-transform ${showRules ? 'rotate-180' : ''}`} /></button>
                    {showRules && (<div className="mt-4 space-y-4"><div className="flex gap-2"><input type="text" value={newRuleText} onChange={(e) => setNewRuleText(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && addRule()} placeholder="e.g., Must include #BrandPartner" className="flex-grow p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary" /><button onClick={addRule} className="px-4 py-2 bg-secondary text-white rounded-md hover:bg-primary flex items-center gap-1"><PlusIcon/> Add</button></div>{customRules.length > 0 ? (<ul className="space-y-2">{customRules.map(rule => (<li key={rule.id} className="flex justify-between items-center bg-white p-2 rounded-md border"><p className="text-sm text-gray-800">{rule.text}</p><button onClick={() => deleteRule(rule.id)} className="p-1 text-gray-400 hover:text-red-500"><TrashIcon/></button></li>))}</ul>) : (<p className="text-sm text-gray-500 text-center py-2">No custom rules defined.</p>)}</div>)}
                  </div>
                  
                  {analysisType === 'text' && (<div className="bg-white p-6 rounded-lg shadow-md"><textarea value={postContent} onChange={(e) => setPostContent(e.target.value)} placeholder="Paste influencer post caption here..." className="w-full h-40 p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary" disabled={isLoading} /><div className="mt-4 flex flex-col sm:flex-row items-center justify-between gap-4"><button onClick={() => setPostContent(examplePost)} disabled={isLoading} className="text-sm text-primary hover:underline disabled:text-gray-400">Load Example</button><button onClick={handleScan} disabled={isLoading} className="w-full sm:w-auto px-6 py-3 bg-primary text-white font-semibold rounded-md shadow-sm hover:bg-secondary disabled:bg-gray-400">{isLoading ? 'Analyzing...' : 'Scan Post'}</button></div></div>)}
                  {analysisType === 'video' && (<div className="bg-white p-6 rounded-lg shadow-md space-y-4"><div><label className="block text-sm font-medium text-gray-700 mb-1">Step 1: Choose Video File</label><input type="file" accept="video/*" onChange={(e) => setSelectedVideoFile(e.target.files[0])} className="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-primary/10 file:text-primary hover:file:bg-primary/20" disabled={isLoading} />{selectedVideoFile && <p className="text-xs text-gray-500 mt-2">Selected: {selectedVideoFile.name}</p>}</div><div><label className="block text-sm font-medium text-gray-700 mb-1">Step 2: Paste Video Transcript</label><textarea value={videoTranscript} onChange={(e) => setVideoTranscript(e.target.value)} placeholder="Paste the full video transcript here..." className="w-full h-40 p-3 border border-gray-300 rounded-md" disabled={isLoading} /></div><div className="mt-4 flex flex-col sm:flex-row items-center justify-between gap-4"><button onClick={() => setVideoTranscript(exampleVideoTranscript)} disabled={isLoading} className="text-sm text-primary hover:underline disabled:text-gray-400">Load Example</button><button onClick={handleScan} disabled={isLoading || !videoTranscript.trim() || !selectedVideoFile} className="w-full sm:w-auto px-6 py-3 bg-primary text-white font-semibold rounded-md shadow-sm hover:bg-secondary disabled:bg-gray-400">{isLoading ? 'Analyzing...' : 'Scan Video'}</button></div></div>)}
                  
                  <div className="mt-8">{isLoading && <Loader />}{error && <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg" role="alert">{error}</div>}{report && <ReportCard report={report} geminiService={geminiService} />}</div>
              </div>
              <aside className="lg:col-span-1">
                <div className="bg-white p-6 rounded-lg shadow-md sticky top-24">
                  <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2"><HistoryIcon /> Recent Reports</h2>
                  {reportHistory.length > 0 ? (<ul className="space-y-3 max-h-96 overflow-y-auto">{reportHistory.map((r) => (<li key={r.id} className="group flex items-center justify-between p-3 rounded-md hover:bg-gray-100"><button onClick={() => viewHistoricReport(r)} className="text-left flex-grow truncate"><div className={`text-xs font-semibold uppercase ${r.analysisType === 'text' ? 'text-blue-500' : 'text-purple-500'}`}>{r.analysisType}</div><p className="text-sm text-gray-700 truncate">{r.sourceContent}</p><p className="text-xs text-gray-500">{new Date(r.timestamp).toLocaleString()}</p></button><button onClick={() => deleteReport(r.id)} className="ml-2 p-1 text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100"><TrashIcon /></button></li>))}</ul>) : (<p className="text-sm text-gray-500 text-center py-4">No reports yet.</p>)}
                </div>
              </aside>
            </div>
          </div>
        );
      };

      // --- Main App Component ---
      const App = () => {
        const [view, setView] = useState('landing');
        const [sharedReport, setSharedReport] = useState(null);
        
        const geminiService = useMemo(() => createGeminiService(), []);

        useEffect(() => {
          const params = new URLSearchParams(window.location.search);
          const reportData = params.get('report');
          if (reportData) {
            try {
              const decodedReport = JSON.parse(atob(reportData));
              setSharedReport(decodedReport);
            } catch (e) {
              console.error("Failed to parse shared report data from URL", e);
              window.history.replaceState({}, document.title, window.location.pathname);
            }
          }
        }, []);

        const navigateTo = useCallback((newView) => {
          if (window.location.search) {
              window.history.pushState({}, document.title, window.location.pathname);
          }
          setSharedReport(null);
          setView(newView);
        }, []);

        if (sharedReport) {
          return <PublicReportView report={sharedReport} geminiService={geminiService} />;
        }
        
        if (!geminiService.isConfigured() && view === 'dashboard') {
          return (
             <div>
                <Header navigateTo={navigateTo} />
                <div className="container mx-auto p-8 text-center">
                  <div className="bg-red-100 border-l-4 border-red-500 text-red-700 p-6 rounded-lg max-w-2xl mx-auto">
                    <h2 className="font-bold text-2xl mb-2">Configuration Error</h2>
                    <p className="text-left">The Gemini API Key has not been set up correctly. To enable this application, the site owner must edit the <strong>index.html</strong> file and replace the <strong>"YOUR_API_KEY_HERE"</strong> placeholder with a valid Google Gemini API key.</p>
                  </div>
                </div>
             </div>
          );
        }

        return (
          <div className="min-h-screen bg-gray-50">
            <Header navigateTo={navigateTo} />
            <main>
              {view === 'landing' ? (
                <>
                  <Hero navigateToDashboard={() => navigateTo('dashboard')} />
                  <Features />
                </>
              ) : (
                <Dashboard geminiService={geminiService} />
              )}
            </main>
            <footer className="text-center p-4 text-gray-500 text-sm">
              <p>&copy; 2024 BrandGuard AI. All rights reserved. An AI-founded company.</p>
            </footer>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);

    </script>
  </body>
</html>
